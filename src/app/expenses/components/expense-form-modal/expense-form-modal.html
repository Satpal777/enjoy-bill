<app-modal [isOpen]="isOpen()" [title]="modalTitle()" (close)="onClose()">

    <svg modal-icon xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
        stroke="currentColor" class="w-5 h-5 text-white">
        <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>

    <form modal-content [formGroup]="expenseForm" (ngSubmit)="onSubmit()">
        <div class="space-y-5">

            <!-- Description -->
            <div>
                <label class="block text-xs font-bold uppercase tracking-wide text-slate-400 mb-2">Description</label>
                <input formControlName="description" type="text" placeholder="e.g. Dinner at Mario's" class="w-full bg-slate-900/70 border border-slate-600/50 rounded-xl px-5 py-4 text-white 
          placeholder-slate-500 focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none 
          transition-all duration-200 backdrop-blur-sm hover:border-slate-500/50" autofocus>
            </div>

            <!-- Amount & Currency -->
            <div class="grid grid-cols-3 gap-4">
                <div class="col-span-2">
                    <label class="block text-xs font-bold uppercase tracking-wide text-slate-400 mb-2">Amount</label>
                    <input formControlName="amount" type="number" min="1" step="1" placeholder="0.00" class="w-full bg-slate-900/70 border border-slate-600/50 rounded-xl px-5 py-4 text-white 
            placeholder-slate-500 focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none 
            transition-all duration-200 backdrop-blur-sm hover:border-slate-500/50">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wide text-slate-400 mb-2">Currency</label>
                    <select formControlName="currency" class="w-full bg-slate-900/70 border border-slate-600/50 rounded-xl px-3 py-4 text-white 
            focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all 
            duration-200 cursor-pointer">
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="INR">INR</option>
                        <option value="GBP">GBP</option>
                    </select>
                </div>
            </div>

            <!-- Paid By & Date -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wide text-slate-400 mb-2">Paid By</label>
                    <select formControlName="paidBy" class="w-full bg-slate-900/70 border border-slate-600/50 rounded-xl px-4 py-4 text-white 
            focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all 
            duration-200 cursor-pointer">
                        <option [ngValue]="null" disabled>Select Payer</option>
                        @for(member of members(); track member.id) {
                        <option [value]="member.id">{{ member.name }}</option>
                        }
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wide text-slate-400 mb-2">Date</label>
                    <input formControlName="date" type="date" class="w-full bg-slate-900/70 border border-slate-600/50 rounded-xl px-4 py-4 text-white 
            focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all 
            duration-200 [color-scheme:dark] cursor-pointer">
                </div>
            </div>

            <!-- Category -->
            <div>
                <label class="block text-xs font-bold uppercase tracking-wide text-slate-400 mb-2">Category</label>
                <select formControlName="category" class="w-full bg-slate-900/70 border border-slate-600/50 rounded-xl px-4 py-4 text-white 
          focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all 
          duration-200 cursor-pointer">
                    <option value="" disabled selected>Select a category</option>
                    @for(cat of categories; track cat.value) {
                    <option [value]="cat.value">{{ cat.label }}</option>
                    }
                </select>
            </div>

            <!-- Error Message -->
            @if (expenseForm.invalid && (expenseForm.dirty || expenseForm.touched)) {
            <div class="bg-rose-500/10 border border-rose-500/20 rounded-xl p-3 flex gap-3 items-start">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor" class="w-5 h-5 text-rose-400 mt-0.5">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                </svg>
                <p class="text-sm text-rose-400 leading-relaxed">Please fill in all required fields correctly.</p>
            </div>
            }
        </div>
    </form>

    <div modal-footer class="flex justify-end gap-3">
        <button (click)="onClose()" type="button"
            class="px-5 py-2.5 text-slate-400 hover:text-white font-semibold transition-colors cursor-pointer">
            Cancel
        </button>
        <button (click)="onSubmit()" [disabled]="expenseForm.invalid || isSubmitting()" class="px-8 py-2.5 bg-teal-600 hover:bg-teal-500 text-white rounded-xl font-bold shadow-lg 
      shadow-teal-900/20 transition-all active:scale-95 disabled:opacity-50 
      disabled:cursor-not-allowed cursor-pointer">
            {{ isSubmitting() ? 'Saving...' : submitButtonText() }}
        </button>
    </div>
</app-modal>